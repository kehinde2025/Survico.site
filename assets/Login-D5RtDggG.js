import{u as j,r as m,j as e,z as a}from"./index-BnNZ3P73.js";import{s as N,a as S,p as I}from"./firebase-BYkQpCoV.js";import{a as h}from"./index-Dq7h7Pqt.js";function C(){const r=j(),[o,x]=m.useState({email:"",password:""}),[n,b]=m.useState({}),[p,c]=m.useState(""),u=s=>{x({...o,[s.target.name]:s.target.value})},f=()=>{const s={};return o.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||(s.email="Enter a valid email"),(!o.password||o.password.length<6)&&(s.password="Password must be at least 6 characters"),b(s),Object.keys(s).length===0},w=async s=>{if(s.preventDefault(),c(""),!f())return;const d=a.loading("Logging you in...");try{const l=await h.post(`https://survico-backend.up.railway.app/api/surveys?userId=${userId}`,{email:o.email,password:o.password}),{user:t,token:i}=l.data;if(a.dismiss(d),a.success(`ðŸ‘‹ Welcome back, ${t.name}!`),localStorage.setItem("token",i),localStorage.setItem("user",JSON.stringify(t)),t.role==="admin")r("/admin/dashboard");else if(t.role==="spectator")r("/spectator/dashboard");else{const g=t.profileCompleted;r(g?"/dashboard":"/onboarding")}}catch(l){a.dismiss(d);const t=l.response?.data?.message||"Invalid login.";c(t),a.error(t)}},y=async()=>{const s=a.loading("Logging in with Google...");try{const l=(await N(S,I)).user,t=await h.post("http://localhost:5000/api/auth/google",{name:l.displayName,email:l.email}),{user:i,token:g}=t.data;if(a.dismiss(s),a.success("âœ… Google login successful!"),localStorage.setItem("token",t.data.token),localStorage.setItem("user",JSON.stringify(t.data.user)),i.role==="admin")r("/admin/dashboard");else if(i.role==="spectator")r("/spectator/dashboard");else{const v=i.profileCompleted;r(v?"/dashboard":"/onboarding")}}catch{a.dismiss(s),c("Google login failed."),a.error("Google login failed.")}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#140932] px-4",children:e.jsxs("div",{className:"bg-[#685699] rounded-lg shadow-lg p-8 w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6 text-center",children:"Log In to Survico"}),p&&e.jsx("p",{className:"text-sm text-red-500 mb-2 text-center",children:p}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsx("input",{type:"email",name:"email",placeholder:"Email address",value:o.email,onChange:u,className:`w-full px-4 py-2 border rounded focus:outline-none ${n.email?"border-red-500":""}`}),n.email&&e.jsx("p",{className:"text-sm text-red-500",children:n.email}),e.jsx("input",{type:"password",name:"password",placeholder:"Password",value:o.password,onChange:u,className:`w-full px-4 py-2 border rounded focus:outline-none ${n.password?"border-red-500":""}`}),n.password&&e.jsx("p",{className:"text-sm text-red-500",children:n.password}),e.jsx("button",{type:"submit",className:"w-full bg-blue-700 text-white py-2 rounded hover:bg-blue-800",children:"Log In"})]}),e.jsx("p",{className:"text-sm text-white text-center pt-5",children:"Or"}),e.jsx("button",{type:"button",onClick:y,className:"w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 mt-4",children:"Log In with Google"}),e.jsxs("p",{className:"text-sm text-center mt-4",children:["Donâ€™t have an account?"," ",e.jsx("a",{href:"/signup",className:"text-white hover:underline",children:"Sign Up"})]})]})})}export{C as default};
